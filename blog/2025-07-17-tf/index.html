<!doctype html>
<html lang="en">

<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HQ9863ZP35"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-HQ9863ZP35');
  </script>
  <title>Capillaries blog: run profiles - worker threads or writers?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="shortcut icon" type="image/x-icon" href="../../favicon.ico">
  <link href="../../css/color.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
    crossorigin="anonymous"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
      <a class="navbar-brand" href="../index.html"><img src="../../i/logo.svg" alt="Capillaries logo"
          style="width:20px;margin-right:10px;margin-bottom:5px;">Capillaries: notes</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="../index.html">Blog home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" aria-current="page" href="https://github.com/capillariesio/capillaries">Source code</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container">

    <div class="row mt-4 mb-4">
      <div class="col-12">
        <h4>2024-07-17</h4>
        <h2>Capillaries: Terraform deployment, scalability updates, and thread parameters</h2>
      </div>
    </div>

    <div class="row">
      <div class="col-9">
        <h3>Scalability numbers</h3>
        <p>
          The <a href="https://github.com/capillariesio/capillaries-deploy">capillaries-deploy</a> project has been put
          on hold, <a
            href="https://github.com/capillariesio/capillaries/tree/main/deploy/tf/cassandra_cluster">Terraform</a> is
          now the preferred tool for testing Capillaries deployments.
          Another round of scalability testing was performed. As before, we use setups where:
        </p>
        <ul>
          <li>number_of_daemons = number_of_cassandra_nodes</li>
          <li>Cassandra nodes are x4 more powerful than Capillaries instances</li>
        </ul>
        <p>Here is what
          has changed since the <a href="https://capillaries.io/blog/2024-08-10-scaleup-scaleout/index.html">last
            round</a>:
        </p>
        <ul>
          <li><a href="https://github.com/capillariesio/capillaries/pull/87">code improvements</a>: async Cassandra
            writer with no unnecessary buffering; configuration file caching</li>
          <li>updated worker thread and Cassandra writer thread parameters</li>
          <li>RabbitMQ and Prometheus servers now run on the bastion VM (see <a
              href="https://raw.githubusercontent.com/capillariesio/capillaries/refs/heads/main/deploy/tf/cassandra_cluster/doc/deployment.svg">deployment
              diagram</a>)</li>
          <li>each test now uses three runs - load, join, and calc - instead of a single run: this makes execution
            pattern analysis easier</li>
          <li>the GOMEMLIMIT environment variable is now set to prevent OOM errors in high-load scenarios</li>
        </ul>
        <p>As <a href="https://capillaries.io/blog/2024-08-10-scaleup-scaleout/index.html">before</a>, <a
            href="https://github.com/capillariesio/capillaries/blob/main/test/code/portfolio/README.md">portfolio
            test</a> is used for performance benchmarking. The updated results are presented below.</p>
      </div>
      <div class="col-3">
        <img src="./i/many-old-pcs.png" class="img-fluid" />
      </div>
    </div>

    <div class="row">
      <table class="table table-striped text-right" style="font-size:smaller">
        <thead>
          <th class="text-center">Deployment flavor</th>
          <th class="text-center" colspan="3">AWS instance</th>
          <th class="text-center" colspan="2">4 Cassandra nodes</th>
          <th class="text-center" colspan="2">8 Cassandra nodes</th>
          <th class="text-center" colspan="2">16 Cassandra nodes</th>
          <th class="text-center" colspan="2">32 Cassandra nodes</th>
        </thead>
        <thead>
          <th class="text-right"></th>
          <th class="text-right">Cassandra</th>
          <th class="text-right">Daemon</th>
          <th class="text-right">Bastion/RabbitMQ/Prometheus</th>
          <th class="text-right">Total cores</th>
          <th class="text-right">Hourly cost</th>
          <th class="text-right">Total cores</th>
          <th class="text-right">Hourly cost</th>
          <th class="text-right">Total cores</th>
          <th class="text-right">Hourly cost</th>
          <th class="text-right">Total cores</th>
          <th class="text-right">Hourly cost</th>
        </thead>
        <tbody>
          <tr class="color8">
            <td>aws.arm64.c7g.8</td>
            <td>c7gd.2xlarge</td>
            <td>c7g.large</td>
            <td>c7g.large</td>
            <td>42</td>
            <td>$1.8141</td>
            <td>82</td>
            <td>$3.5557</td>
            <td>162</td>
            <td>$7.0389</td>
            <td>322</td>
            <td>$14.0053</td>
          </tr>
          <tr class="color16">
            <td>aws.arm64.c7g.16</td>
            <td>c7gd.4xlarge</td>
            <td>c7g.xlarge</td>
            <td>c7g.large</td>
            <td>82</td>
            <td>$3.5557</td>
            <td>162</td>
            <td>$7.0389</td>
            <td>322</td>
            <td>$14.0053</td>
            <td></td>
            <td></td>
          </tr>
          <tr class="color32">
            <td>aws.arm64.c7g.32</td>
            <td>c7gd.8xlarge</td>
            <td>c7g.2xlarge</td>
            <td>c7g.large</td>
            <td>162</td>
            <td>$7.0385</td>
            <td>322</td>
            <td>$14.0045</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
          <tr class="color64">
            <td>aws.arm64.c7g.64</td>
            <td>c7gd.16xlarge</td>
            <td>c7g.4xlarge</td>
            <td>c7g.large</td>
            <td>322</td>
            <td>$14.0045</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="row mt-4 mb-4">
      <div class="accordion" id="accordionTests">
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-8-4">
            <button class="accordion-button color8 collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse-8-4" aria-expanded="false" aria-controls="collapse-8-4">
              <div class="col-2">aws.arm64.c7g.8</div>
              <div class="col-3">Cassandra cores 8</div>
              <div class="col-3">Cassandra nodes 4</div>
              <div class="col-2">976 seconds</div>
              <div class="col-1">$0.49</div>
            </button>
          </h2>
          <div id="collapse-8-4" class="accordion-collapse collapse" aria-labelledby="heading-8-4">
            <div class="accordion-body">
              <div class="accordion" id="accordionTests-8-4">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-4-cfg">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-4-cfg" aria-expanded="false" aria-controls="collapse-8-4-cfg">
                      Terraform config
                    </button>
                  </h2>
                  <div id="collapse-8-4-cfg" class="accordion-collapse collapse" aria-labelledby="heading-8-4-cfg">
                    <div class="accordion-body">
                      <pre>
output_cassandra_cpus = "8 cpus ($0.362900/hr)"
output_cassandra_hosts = 4
output_cassandra_total_cpus = 32
output_daemon_cpus = "2 cpus ($0.072500/hr)"
output_daemon_instances = 4
output_daemon_thread_pool_size = 6
output_daemon_total_cpus = 8
output_daemon_writer_workers = 12
output_daemon_writers_per_cassandra_cpu = 9
output_total_ec2_hourly_cost = "$1.814100/hr"
      </pre>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-4-runs">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-4-runs" aria-expanded="false" aria-controls="collapse-8-4-runs">
                      Test runs
                    </button>
                  </h2>
                  <div id="collapse-8-4-runs" class="accordion-collapse collapse" aria-labelledby="heading-8-4-runs">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/4/00-runs.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-4-cpu">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-4-cpu" aria-expanded="false" aria-controls="collapse-8-4-cpu">
                      CPU usage
                    </button>
                  </h2>
                  <div id="collapse-8-4-cpu" class="accordion-collapse collapse" aria-labelledby="heading-8-4-cpu">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/4/01-cpu.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-4-mem">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-4-mem" aria-expanded="false" aria-controls="collapse-8-4-mem">
                      Memory usage
                    </button>
                  </h2>
                  <div id="collapse-8-4-mem" class="accordion-collapse collapse" aria-labelledby="heading-8-4-mem">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/4/02-mem.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-4-reads">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-4-reads" aria-expanded="false" aria-controls="collapse-8-4-reads">
                      Cassandra reads
                    </button>
                  </h2>
                  <div id="collapse-8-4-reads" class="accordion-collapse collapse" aria-labelledby="heading-8-4-reads">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/4/03-reads.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-4-writes">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-4-writes" aria-expanded="false" aria-controls="collapse-8-4-writes">
                      Cassandra writes
                    </button>
                  </h2>
                  <div id="collapse-8-4-writes" class="accordion-collapse collapse"
                    aria-labelledby="heading-8-4-writes">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/4/04-writes.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-8-8">
            <button class="accordion-button color8 collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse-8-8" aria-expanded="false" aria-controls="collapse-8-8">
              <div class="col-2">aws.arm64.c7g.8</div>
              <div class="col-3">Cassandra cores 8</div>
              <div class="col-3">Cassandra nodes 8</div>
              <div class="col-2">578 seconds</div>
              <div class="col-1">$0.57</div>
            </button>
          </h2>
          <div id="collapse-8-8" class="accordion-collapse collapse" aria-labelledby="heading-8-8">
            <div class="accordion-body">
              <div class="accordion" id="accordionTests-8-8">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-8-cfg">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-8-cfg" aria-expanded="false" aria-controls="collapse-8-8-cfg">
                      Terraform config
                    </button>
                  </h2>
                  <div id="collapse-8-8-cfg" class="accordion-collapse collapse" aria-labelledby="heading-8-8-cfg">
                    <div class="accordion-body">
                      <pre>
output_cassandra_cpus = "8 cpus ($0.362900/hr)"
output_cassandra_hosts = 8
output_cassandra_total_cpus = 64
output_daemon_cpus = "2 cpus ($0.072500/hr)"
output_daemon_instances = 8
output_daemon_thread_pool_size = 6
output_daemon_total_cpus = 16
output_daemon_writer_workers = 12
output_daemon_writers_per_cassandra_cpu = 9
output_total_ec2_hourly_cost = "$3.555700/hr"
      </pre>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-8-runs">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-8-runs" aria-expanded="false" aria-controls="collapse-8-8-runs">
                      Test runs
                    </button>
                  </h2>
                  <div id="collapse-8-8-runs" class="accordion-collapse collapse" aria-labelledby="heading-8-8-runs">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/8/00-runs.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-8-cpu">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-8-cpu" aria-expanded="false" aria-controls="collapse-8-8-cpu">
                      CPU usage
                    </button>
                  </h2>
                  <div id="collapse-8-8-cpu" class="accordion-collapse collapse" aria-labelledby="heading-8-8-cpu">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/8/01-cpu.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-8-mem">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-8-mem" aria-expanded="false" aria-controls="collapse-8-8-mem">
                      Memory usage
                    </button>
                  </h2>
                  <div id="collapse-8-8-mem" class="accordion-collapse collapse" aria-labelledby="heading-8-8-mem">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/8/02-mem.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-8-reads">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-8-reads" aria-expanded="false" aria-controls="collapse-8-8-reads">
                      Cassandra reads
                    </button>
                  </h2>
                  <div id="collapse-8-8-reads" class="accordion-collapse collapse" aria-labelledby="heading-8-8-reads">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/8/03-reads.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-8-writes">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-8-writes" aria-expanded="false" aria-controls="collapse-8-8-writes">
                      Cassandra writes
                    </button>
                  </h2>
                  <div id="collapse-8-8-writes" class="accordion-collapse collapse"
                    aria-labelledby="heading-8-8-writes">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/8/04-writes.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-8-16">
            <button class="accordion-button color8 collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse-8-16" aria-expanded="false" aria-controls="collapse-8-16">
              <div class="col-2">aws.arm64.c7g.8</div>
              <div class="col-3">Cassandra cores 8</div>
              <div class="col-3">Cassandra nodes 16</div>
              <div class="col-2">296 seconds</div>
              <div class="col-1">$0.58</div>
            </button>
          </h2>
          <div id="collapse-8-16" class="accordion-collapse collapse" aria-labelledby="heading-8-16">
            <div class="accordion-body">
              <div class="accordion" id="accordionTests-8-16">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-16-cfg">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-16-cfg" aria-expanded="false" aria-controls="collapse-8-16-cfg">
                      Terraform config
                    </button>
                  </h2>
                  <div id="collapse-8-16-cfg" class="accordion-collapse collapse" aria-labelledby="heading-8-16-cfg">
                    <div class="accordion-body">
                      <pre>
output_cassandra_cpus = "8 cpus ($0.362900/hr)"
output_cassandra_hosts = 16
output_cassandra_total_cpus = 128
output_daemon_cpus = "2 cpus ($0.072500/hr)"
output_daemon_instances = 16
output_daemon_thread_pool_size = 6
output_daemon_total_cpus = 32
output_daemon_writer_workers = 12
output_daemon_writers_per_cassandra_cpu = 9
output_total_ec2_hourly_cost = "$7.038900/hr"
      </pre>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-16-runs">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-16-runs" aria-expanded="false" aria-controls="collapse-8-16-runs">
                      Test runs
                    </button>
                  </h2>
                  <div id="collapse-8-16-runs" class="accordion-collapse collapse" aria-labelledby="heading-8-16-runs">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/16/00-runs.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-16-cpu">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-16-cpu" aria-expanded="false" aria-controls="collapse-8-16-cpu">
                      CPU usage
                    </button>
                  </h2>
                  <div id="collapse-8-16-cpu" class="accordion-collapse collapse" aria-labelledby="heading-8-16-cpu">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/16/01-cpu.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-16-mem">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-16-mem" aria-expanded="false" aria-controls="collapse-8-16-mem">
                      Memory usage
                    </button>
                  </h2>
                  <div id="collapse-8-16-mem" class="accordion-collapse collapse" aria-labelledby="heading-8-16-mem">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/16/02-mem.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-16-reads">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-16-reads" aria-expanded="false" aria-controls="collapse-8-16-reads">
                      Cassandra reads
                    </button>
                  </h2>
                  <div id="collapse-8-16-reads" class="accordion-collapse collapse"
                    aria-labelledby="heading-8-16-reads">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/16/03-reads.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-16-writes">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-16-writes" aria-expanded="false" aria-controls="collapse-8-16-writes">
                      Cassandra writes
                    </button>
                  </h2>
                  <div id="collapse-8-16-writes" class="accordion-collapse collapse"
                    aria-labelledby="heading-8-16-writes">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/16/04-writes.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-8-32">
            <button class="accordion-button color8 collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse-8-32" aria-expanded="false" aria-controls="collapse-8-32">
              <div class="col-2">aws.arm64.c7g.8</div>
              <div class="col-3">Cassandra cores 8</div>
              <div class="col-3">Cassandra nodes 32</div>
              <div class="col-2">198 seconds</div>
              <div class="col-1">$0.77</div>
            </button>
          </h2>
          <div id="collapse-8-32" class="accordion-collapse collapse" aria-labelledby="heading-8-32">
            <div class="accordion-body">
              <div class="accordion" id="accordionTests-8-32">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-32-cfg">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-32-cfg" aria-expanded="false" aria-controls="collapse-8-32-cfg">
                      Terraform config
                    </button>
                  </h2>
                  <div id="collapse-8-32-cfg" class="accordion-collapse collapse" aria-labelledby="heading-8-32-cfg">
                    <div class="accordion-body">
                      <pre>
output_cassandra_cpus                       = "8 cpus ($0.362900/hr)"
output_cassandra_hosts                      = 32
output_cassandra_total_cpus                 = 256
output_daemon_cpus                          = "2 cpus ($0.072500/hr)"
output_daemon_instances                     = 32
output_daemon_thread_pool_size              = 6
output_daemon_total_cpus                    = 64
output_daemon_writer_workers                = 12
output_daemon_writers_per_cassandra_cpu     = 9
output_total_ec2_hourly_cost                = "$14.005300/hr"

      </pre>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-32-runs">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-32-runs" aria-expanded="false" aria-controls="collapse-8-32-runs">
                      Test runs
                    </button>
                  </h2>
                  <div id="collapse-8-32-runs" class="accordion-collapse collapse" aria-labelledby="heading-8-32-runs">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/32/00-runs.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-32-cpu">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-32-cpu" aria-expanded="false" aria-controls="collapse-8-32-cpu">
                      CPU usage
                    </button>
                  </h2>
                  <div id="collapse-8-32-cpu" class="accordion-collapse collapse" aria-labelledby="heading-8-32-cpu">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/32/01-cpu.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-32-mem">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-32-mem" aria-expanded="false" aria-controls="collapse-8-32-mem">
                      Memory usage
                    </button>
                  </h2>
                  <div id="collapse-8-32-mem" class="accordion-collapse collapse" aria-labelledby="heading-8-32-mem">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/32/02-mem.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-32-reads">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-32-reads" aria-expanded="false" aria-controls="collapse-8-32-reads">
                      Cassandra reads
                    </button>
                  </h2>
                  <div id="collapse-8-32-reads" class="accordion-collapse collapse"
                    aria-labelledby="heading-8-32-reads">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/32/03-reads.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-8-32-writes">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-8-32-writes" aria-expanded="false" aria-controls="collapse-8-32-writes">
                      Cassandra writes
                    </button>
                  </h2>
                  <div id="collapse-8-32-writes" class="accordion-collapse collapse"
                    aria-labelledby="heading-8-32-writes">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.8/32/04-writes.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-16-4">
            <button class="accordion-button color16 collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse-16-4" aria-expanded="false" aria-controls="collapse-16-4">
              <div class="col-2">aws.arm64.c7g.16</div>
              <div class="col-3">Cassandra cores 16</div>
              <div class="col-3">Cassandra nodes 4</div>
              <div class="col-2">503 seconds</div>
              <div class="col-1">$0.50</div>
            </button>
          </h2>
          <div id="collapse-16-4" class="accordion-collapse collapse" aria-labelledby="heading-16-4">
            <div class="accordion-body">
              <div class="accordion" id="accordionTests-16-4">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-4-cfg">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-4-cfg" aria-expanded="false" aria-controls="collapse-16-4-cfg">
                      Terraform config
                    </button>
                  </h2>
                  <div id="collapse-16-4-cfg" class="accordion-collapse collapse" aria-labelledby="heading-16-4-cfg">
                    <div class="accordion-body">
                      <pre>
output_cassandra_cpus                       = "16 cpus ($0.725800/hr)"
output_cassandra_hosts                      = 4
output_cassandra_total_cpus                 = 64
output_daemon_cpus                          = "4 cpus ($0.145000/hr)"
output_daemon_instances                     = 4
output_daemon_thread_pool_size              = 12
output_daemon_total_cpus                    = 16
output_daemon_writer_workers                = 12
output_daemon_writers_per_cassandra_cpu     = 9
output_total_ec2_hourly_cost                = "$3.555700/hr"
      </pre>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-4-runs">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-4-runs" aria-expanded="false" aria-controls="collapse-16-4-runs">
                      Test runs
                    </button>
                  </h2>
                  <div id="collapse-16-4-runs" class="accordion-collapse collapse" aria-labelledby="heading-16-4-runs">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/4/00-runs.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-4-cpu">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-4-cpu" aria-expanded="false" aria-controls="collapse-16-4-cpu">
                      CPU usage
                    </button>
                  </h2>
                  <div id="collapse-16-4-cpu" class="accordion-collapse collapse" aria-labelledby="heading-16-4-cpu">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/4/01-cpu.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-4-mem">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-4-mem" aria-expanded="false" aria-controls="collapse-16-4-mem">
                      Memory usage
                    </button>
                  </h2>
                  <div id="collapse-16-4-mem" class="accordion-collapse collapse" aria-labelledby="heading-16-4-mem">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/4/02-mem.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-4-reads">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-4-reads" aria-expanded="false" aria-controls="collapse-16-4-reads">
                      Cassandra reads
                    </button>
                  </h2>
                  <div id="collapse-16-4-reads" class="accordion-collapse collapse"
                    aria-labelledby="heading-16-4-reads">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/4/03-reads.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-4-writes">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-4-writes" aria-expanded="false" aria-controls="collapse-16-4-writes">
                      Cassandra writes
                    </button>
                  </h2>
                  <div id="collapse-16-4-writes" class="accordion-collapse collapse"
                    aria-labelledby="heading-16-4-writes">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/4/04-writes.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-16-8">
            <button class="accordion-button color16 collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse-16-8" aria-expanded="false" aria-controls="collapse-16-8">
              <div class="col-2">aws.arm64.c7g.16</div>
              <div class="col-3">Cassandra cores 16</div>
              <div class="col-3">Cassandra nodes 8</div>
              <div class="col-2">275 seconds</div>
              <div class="col-1">$0.54</div>
            </button>
          </h2>
          <div id="collapse-16-8" class="accordion-collapse collapse" aria-labelledby="heading-16-8">
            <div class="accordion-body">
              <div class="accordion" id="accordionTests-16-8">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-8-cfg">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-8-cfg" aria-expanded="false" aria-controls="collapse-16-8-cfg">
                      Terraform config
                    </button>
                  </h2>
                  <div id="collapse-16-8-cfg" class="accordion-collapse collapse" aria-labelledby="heading-16-8-cfg">
                    <div class="accordion-body">
                      <pre>
output_cassandra_cpus                       = "16 cpus ($0.725800/hr)"
output_cassandra_hosts                      = 8
output_cassandra_total_cpus                 = 128
output_daemon_cpus                          = "4 cpus ($0.145000/hr)"
output_daemon_instances                     = 8
output_daemon_thread_pool_size              = 12
output_daemon_total_cpus                    = 32
output_daemon_writer_workers                = 12
output_daemon_writers_per_cassandra_cpu     = 9
output_total_ec2_hourly_cost                = "$7.038900/hr"
      </pre>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-8-runs">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-8-runs" aria-expanded="false" aria-controls="collapse-16-8-runs">
                      Test runs
                    </button>
                  </h2>
                  <div id="collapse-16-8-runs" class="accordion-collapse collapse" aria-labelledby="heading-16-8-runs">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/8/00-runs.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-8-cpu">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-8-cpu" aria-expanded="false" aria-controls="collapse-16-8-cpu">
                      CPU usage
                    </button>
                  </h2>
                  <div id="collapse-16-8-cpu" class="accordion-collapse collapse" aria-labelledby="heading-16-8-cpu">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/8/01-cpu.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-8-mem">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-8-mem" aria-expanded="false" aria-controls="collapse-16-8-mem">
                      Memory usage
                    </button>
                  </h2>
                  <div id="collapse-16-8-mem" class="accordion-collapse collapse" aria-labelledby="heading-16-8-mem">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/8/02-mem.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-8-reads">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-8-reads" aria-expanded="false" aria-controls="collapse-16-8-reads">
                      Cassandra reads
                    </button>
                  </h2>
                  <div id="collapse-16-8-reads" class="accordion-collapse collapse"
                    aria-labelledby="heading-16-8-reads">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/8/03-reads.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-8-writes">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-8-writes" aria-expanded="false" aria-controls="collapse-16-8-writes">
                      Cassandra writes
                    </button>
                  </h2>
                  <div id="collapse-16-8-writes" class="accordion-collapse collapse"
                    aria-labelledby="heading-16-8-writes">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/8/04-writes.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-16-16">
            <button class="accordion-button color16 collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse-16-16" aria-expanded="false" aria-controls="collapse-16-16">
              <div class="col-2">aws.arm64.c7g.16</div>
              <div class="col-3">Cassandra cores 16</div>
              <div class="col-3">Cassandra nodes 16</div>
              <div class="col-2">176 seconds</div>
              <div class="col-1">$0.68</div>
            </button>
          </h2>
          <div id="collapse-16-16" class="accordion-collapse collapse" aria-labelledby="heading-16-16">
            <div class="accordion-body">
              <div class="accordion" id="accordionTests-16-16">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-16-cfg">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-16-cfg" aria-expanded="false" aria-controls="collapse-16-16-cfg">
                      Terraform config
                    </button>
                  </h2>
                  <div id="collapse-16-16-cfg" class="accordion-collapse collapse" aria-labelledby="heading-16-16-cfg">
                    <div class="accordion-body">
                      <pre>
output_cassandra_cpus                       = "16 cpus ($0.725800/hr)"
output_cassandra_hosts                      = 16
output_cassandra_total_cpus                 = 256
output_daemon_cpus                          = "4 cpus ($0.145000/hr)"
output_daemon_instances                     = 16
output_daemon_thread_pool_size              = 12
output_daemon_total_cpus                    = 64
output_daemon_writer_workers                = 12
output_daemon_writers_per_cassandra_cpu     = 9
output_total_ec2_hourly_cost                = "$14.005300/hr"
      </pre>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-16-runs">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-16-runs" aria-expanded="false" aria-controls="collapse-16-16-runs">
                      Test runs
                    </button>
                  </h2>
                  <div id="collapse-16-16-runs" class="accordion-collapse collapse"
                    aria-labelledby="heading-16-16-runs">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/16/00-runs.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-16-cpu">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-16-cpu" aria-expanded="false" aria-controls="collapse-16-16-cpu">
                      CPU usage
                    </button>
                  </h2>
                  <div id="collapse-16-16-cpu" class="accordion-collapse collapse" aria-labelledby="heading-16-16-cpu">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/16/01-cpu.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-16-mem">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-16-mem" aria-expanded="false" aria-controls="collapse-16-16-mem">
                      Memory usage
                    </button>
                  </h2>
                  <div id="collapse-16-16-mem" class="accordion-collapse collapse" aria-labelledby="heading-16-16-mem">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/16/02-mem.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-16-reads">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-16-reads" aria-expanded="false" aria-controls="collapse-16-16-reads">
                      Cassandra reads
                    </button>
                  </h2>
                  <div id="collapse-16-16-reads" class="accordion-collapse collapse"
                    aria-labelledby="heading-16-16-reads">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/16/03-reads.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-16-16-writes">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-16-16-writes" aria-expanded="false"
                      aria-controls="collapse-16-16-writes">
                      Cassandra writes
                    </button>
                  </h2>
                  <div id="collapse-16-16-writes" class="accordion-collapse collapse"
                    aria-labelledby="heading-16-16-writes">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.16/16/04-writes.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-32-4">
            <button class="accordion-button color32 collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse-32-4" aria-expanded="false" aria-controls="collapse-32-4">
              <div class="col-2">aws.arm64.c7g.32</div>
              <div class="col-3">Cassandra cores 32</div>
              <div class="col-3">Cassandra nodes 4</div>
              <div class="col-2">270 seconds</div>
              <div class="col-1">$0.53</div>
            </button>
          </h2>
          <div id="collapse-32-4" class="accordion-collapse collapse" aria-labelledby="heading-32-4">
            <div class="accordion-body">
              <div class="accordion" id="accordionTests-32-4">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-4-cfg">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-4-cfg" aria-expanded="false" aria-controls="collapse-32-4-cfg">
                      Terraform config
                    </button>
                  </h2>
                  <div id="collapse-32-4-cfg" class="accordion-collapse collapse" aria-labelledby="heading-32-4-cfg">
                    <div class="accordion-body">
                      <pre>
output_cassandra_cpus                       = "32 cpus ($1.451500/hr)"
output_cassandra_hosts                      = 4
output_cassandra_total_cpus                 = 128
output_daemon_cpus                          = "8 cpus ($0.290000/hr)"
output_daemon_instances                     = 4
output_daemon_thread_pool_size              = 24
output_daemon_total_cpus                    = 32
output_daemon_writer_workers                = 12
output_daemon_writers_per_cassandra_cpu     = 9
output_total_ec2_hourly_cost                = "$7.038500/hr"
      </pre>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-4-runs">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-4-runs" aria-expanded="false" aria-controls="collapse-32-4-runs">
                      Test runs
                    </button>
                  </h2>
                  <div id="collapse-32-4-runs" class="accordion-collapse collapse" aria-labelledby="heading-32-4-runs">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.32/4/00-runs.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-4-cpu">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-4-cpu" aria-expanded="false" aria-controls="collapse-32-4-cpu">
                      CPU usage
                    </button>
                  </h2>
                  <div id="collapse-32-4-cpu" class="accordion-collapse collapse" aria-labelledby="heading-32-4-cpu">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.32/4/01-cpu.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-4-mem">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-4-mem" aria-expanded="false" aria-controls="collapse-32-4-mem">
                      Memory usage
                    </button>
                  </h2>
                  <div id="collapse-32-4-mem" class="accordion-collapse collapse" aria-labelledby="heading-32-4-mem">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.32/4/02-mem.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-4-reads">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-4-reads" aria-expanded="false" aria-controls="collapse-32-4-reads">
                      Cassandra reads
                    </button>
                  </h2>
                  <div id="collapse-32-4-reads" class="accordion-collapse collapse"
                    aria-labelledby="heading-32-4-reads">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.32/4/03-reads.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-4-writes">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-4-writes" aria-expanded="false" aria-controls="collapse-32-4-writes">
                      Cassandra writes
                    </button>
                  </h2>
                  <div id="collapse-32-4-writes" class="accordion-collapse collapse"
                    aria-labelledby="heading-32-4-writes">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.32/4/04-writes.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-32-8">
            <button class="accordion-button color32 collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse-32-8" aria-expanded="false" aria-controls="collapse-32-8">
              <div class="col-2">aws.arm64.c7g.32</div>
              <div class="col-3">Cassandra cores 32</div>
              <div class="col-3">Cassandra nodes 8</div>
              <div class="col-2">176 seconds</div>
              <div class="col-1">$0.68</div>
            </button>
          </h2>
          <div id="collapse-32-8" class="accordion-collapse collapse" aria-labelledby="heading-32-8">
            <div class="accordion-body">
              <div class="accordion" id="accordionTests-32-8">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-8-cfg">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-8-cfg" aria-expanded="false" aria-controls="collapse-32-8-cfg">
                      Terraform config
                    </button>
                  </h2>
                  <div id="collapse-32-8-cfg" class="accordion-collapse collapse" aria-labelledby="heading-32-8-cfg">
                    <div class="accordion-body">
                      <pre>
output_cassandra_cpus                       = "32 cpus ($1.451500/hr)"
output_cassandra_hosts                      = 8
output_cassandra_total_cpus                 = 256
output_daemon_cpus                          = "8 cpus ($0.290000/hr)"
output_daemon_instances                     = 8
output_daemon_thread_pool_size              = 24
output_daemon_total_cpus                    = 64
output_daemon_writer_workers                = 12
output_daemon_writers_per_cassandra_cpu     = 9
output_total_ec2_hourly_cost                = "$14.004500/hr"
      </pre>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-8-runs">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-8-runs" aria-expanded="false" aria-controls="collapse-32-8-runs">
                      Test runs
                    </button>
                  </h2>
                  <div id="collapse-32-8-runs" class="accordion-collapse collapse" aria-labelledby="heading-32-8-runs">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.32/8/00-runs.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-8-cpu">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-8-cpu" aria-expanded="false" aria-controls="collapse-32-8-cpu">
                      CPU usage
                    </button>
                  </h2>
                  <div id="collapse-32-8-cpu" class="accordion-collapse collapse" aria-labelledby="heading-32-8-cpu">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.32/8/01-cpu.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-8-mem">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-8-mem" aria-expanded="false" aria-controls="collapse-32-8-mem">
                      Memory usage
                    </button>
                  </h2>
                  <div id="collapse-32-8-mem" class="accordion-collapse collapse" aria-labelledby="heading-32-8-mem">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.32/8/02-mem.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-8-reads">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-8-reads" aria-expanded="false" aria-controls="collapse-32-8-reads">
                      Cassandra reads
                    </button>
                  </h2>
                  <div id="collapse-32-8-reads" class="accordion-collapse collapse"
                    aria-labelledby="heading-32-8-reads">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.32/8/03-reads.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-32-8-writes">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-32-8-writes" aria-expanded="false" aria-controls="collapse-32-8-writes">
                      Cassandra writes
                    </button>
                  </h2>
                  <div id="collapse-32-8-writes" class="accordion-collapse collapse"
                    aria-labelledby="heading-32-8-writes">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.32/8/04-writes.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="heading-64-4">
            <button class="accordion-button color64 collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#collapse-64-4" aria-expanded="false" aria-controls="collapse-64-4">
              <div class="col-2">aws.arm64.c7g.64</div>
              <div class="col-3">Cassandra cores 64</div>
              <div class="col-3">Cassandra nodes 4</div>
              <div class="col-2">209 seconds</div>
              <div class="col-1">$0.81</div>
            </button>
          </h2>
          <div id="collapse-64-4" class="accordion-collapse collapse" aria-labelledby="heading-64-4">
            <div class="accordion-body">
              <div class="accordion" id="accordionTests-64-4">
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-64-4-cfg">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-64-4-cfg" aria-expanded="false" aria-controls="collapse-64-4-cfg">
                      Terraform config
                    </button>
                  </h2>
                  <div id="collapse-64-4-cfg" class="accordion-collapse collapse" aria-labelledby="heading-64-4-cfg">
                    <div class="accordion-body">
                      <pre>
output_cassandra_cpus                       = "64 cpus ($2.903000/hr)"
output_cassandra_hosts                      = 4
output_cassandra_total_cpus                 = 256
output_daemon_cpus                          = "16 cpus ($0.580000/hr)"
output_daemon_instances                     = 4
output_daemon_thread_pool_size              = 48
output_daemon_total_cpus                    = 64
output_daemon_writer_workers                = 12
output_daemon_writers_per_cassandra_cpu     = 9
output_total_ec2_hourly_cost                = "$14.004500/hr"
      </pre>
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-64-4-runs">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-64-4-runs" aria-expanded="false" aria-controls="collapse-64-4-runs">
                      Test runs
                    </button>
                  </h2>
                  <div id="collapse-64-4-runs" class="accordion-collapse collapse" aria-labelledby="heading-64-4-runs">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.64/4/00-runs.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-64-4-cpu">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-64-4-cpu" aria-expanded="false" aria-controls="collapse-64-4-cpu">
                      CPU usage
                    </button>
                  </h2>
                  <div id="collapse-64-4-cpu" class="accordion-collapse collapse" aria-labelledby="heading-64-4-cpu">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.64/4/01-cpu.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-64-4-mem">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-64-4-mem" aria-expanded="false" aria-controls="collapse-64-4-mem">
                      Memory usage
                    </button>
                  </h2>
                  <div id="collapse-64-4-mem" class="accordion-collapse collapse" aria-labelledby="heading-64-4-mem">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.64/4/02-mem.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-64-4-reads">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-64-4-reads" aria-expanded="false" aria-controls="collapse-64-4-reads">
                      Cassandra reads
                    </button>
                  </h2>
                  <div id="collapse-64-4-reads" class="accordion-collapse collapse"
                    aria-labelledby="heading-64-4-reads">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.64/4/03-reads.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
                <div class="accordion-item">
                  <h2 class="accordion-header" id="heading-64-4-writes">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                      data-bs-target="#collapse-64-4-writes" aria-expanded="false" aria-controls="collapse-64-4-writes">
                      Cassandra writes
                    </button>
                  </h2>
                  <div id="collapse-64-4-writes" class="accordion-collapse collapse"
                    aria-labelledby="heading-64-4-writes">
                    <div class="accordion-body">
                      <img src="./i/s/c7g.64/4/04-writes.png" class="img-fluid" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <img src="./i/time-and-cost.png" class="img-fluid" />
    </div>

    <div class="row">
      <div class="col-12">
        <p>While overall performance numbers have improved, scalability patterns remain largely <a
            href="https://capillaries.io/blog/2024-08-10-scaleup-scaleout/index.html">unchanged</a>.</p>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <h3>Choosing thread parameters</h3>
        <p>Selecting the <a
            href="https://github.com/capillariesio/capillaries/blob/main/doc/binconfig.md#thread_pool_size">thread_pool_size</a>
          and <a
            href="https://github.com/capillariesio/capillaries/blob/main/doc/binconfig.md#writer_workers">writer_workers</a>
          daemon parameters can feel somewhat mysterious. Common sense suggests that thread_pool_size should
          correlate with the number of CPUs/cores, while writer_workers reflects "how many writes per second my
          Cassandra
          cluster can handle". Let's examine a typical CPU usage pattern observed in a low-end VM setup.</p>
        <img src="./i/s/c7g.8/4/01-cpu.png" class="img-fluid" />
        <p>There are clearly three zones in this CPU usage pattern:</p>
        <ul>
          <li>load data from file(s) to Cassandra tables: daemon instances run at 95% CPU (good), Cassandra nodes
            stabilize around 65% (decent)</li>
          <li>joins: daemon CPU usage is low (expected, good), Cassandra is at 60% (decent)</li>
          <li>Python-heavy calculations: daemon CPU usage spikes to 100% (expected, good), Cassandra CPU usage is
            very low (expected, good)</li>
        </ul>
        <p><strong>The objective is to maintain relatively high CPU utilization for both Daemon and Cassandra instances
            across all 3 zones, while also avoiding situations whenre too many daemon threads are idling - waiting for
            Cassandra read/write operations to complete.</strong> Here are some tuning guidelines.</p>
        <ul>
          <li>"load": the rule is simple: hit Cassandra as hard as you can using write_workers and,
            while avoiding OOM errors on the daemon side.</li>
          <li>"joins": increasing thread_pool_size from a reasonable "number_of_cores x 1.5" to "number_of_cores x 3"
            yields good results. Increasing writer_workers beyond a certain point does not
            help much.</li>
          <li>"Python calculations": keep thread_pool_size above the number_of_cores (but not
            exessively high). The writer_workers value is largely irrelevant here, so it can be kept low.</li>
        </ul>
        <p>In the example shown in the CPU profile above, we used "thread_pool_size = number_of_cores x 3" and
          "writer_workers =
          12":</p>
        <pre>
output_cassandra_cpus = "8 cpus ($0.362900/hr)"
output_cassandra_hosts = 4
output_cassandra_total_cpus = 32
output_daemon_cpus = "2 cpus ($0.072500/hr)"
output_daemon_instances = 4
output_daemon_thread_pool_size = 6
output_daemon_total_cpus = 8
output_daemon_writer_workers = 12
output_daemon_writers_per_cassandra_cpu = 9
output_total_ec2_hourly_cost = "$1.814100/hr"          
        </pre>
        <p>Why these values? Mainly because they allow us to avoid OOM errors during the "load" phase while maintaining
          relatively high Casandra CPU usage during both the "load" and "joins" phases.</p>
        <p>"thread_pool_size = number_of_cores x 3" may be
          overkill for the "Python calculations" zone - we could likely achieve similar performance with, say,
          "thread_pool_size =
          number_of_cores x 1.5". Howerver, Capillaries is not smart enough to throttle thread_pool_size
          dynamically based on the type of the transform type.</p>
        <p>Is it worth increasing writer_workers to push Cassandra harder? Observations show that increasing
          writer_workers beyond a certain point yields marginal to negligible improvements.</p>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <h3>The "Cassandra dip"</h3>
        <p>There is a noticeable dip in Cassandra CPU usage at the start of the "load" phase. My theory is that the
          start of the dip <strong>marks the moment when Capillaries daemon garbage collector kicks in</strong>
          consuming CPU cycles that would otherwise support Cassandra writes. This Prometheus metric -
          <i>"100 * (1 - ((avg_over_time(node_memory_MemFree_bytes[1m]) + avg_over_time(node_memory_Cached_bytes[1m]) +
            avg_over_time(node_memory_Buffers_bytes[1m])) / avg_over_time(node_memory_MemTotal_bytes[1m])))"</i> - shows
          memory usage:
        </p>
        <img src="./i/s/c7g.8/4/02-mem.png" class="img-fluid" />
        <p> For this test, GOMEMLIMIT was set to 75% of total RAM. However, because this is a soft limit (and there are
          other processes besides Capillaries daemon running on each instance), daemon memory
          consumption stabilizes around 85%. While this may be aggressive for production environments, it makes
          sense for performance testing.</p>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <h3>Powerful setups: performance degradation?</h3>
        <p>More expensive setups (with more instances or/and more powerful instances) complete the test faster, but
          tend to show higher cost per run. Why? <strong>Why is the black dot on both charts so far from the theoretical
            optimum?</strong> Here is the CPU usage profile for a 4-node Cassandra cluster with 64 cores per node:</p>
        <img src="./i/s/c7g.32/4/01-cpu.png" class="img-fluid" />
        <p>The simple answer: we were not able to sufficiently engage the daemon instances or Cassandra nodes - CPU
          usage
          remained relatively low. But, again, why? There may be a number of explanations for that.</p>
        <ol>
          <li>Insufficient load: There are no clear plateaus in the CPU chart, which might suggest that the test
            dataset (14 million transactions) isnt large enough to sustain high load. This is unlikely though - those
            CPU peaks at 8090% suggest that the hardware was being put to work.</li>
          <li>Idle CPU due to batching: closer to the end of each of the three runs, CPU power may not be fully utilized
            because there's no work left for daemon threads between batches. Using a larger dataset with smaller batch
            sizes might make the right-hand slope of each phase hill steeper - more like a cliff.</li>
          <li>We may be hitting network performance ceilings. AWS instance types with an n offer higher bandwidth, and
            testing with these could confirm this theory.</li>
          <li>Unknown Capillaries design limitations: There may be architectural inefficiencies or bottlenecks in
            Capillaries that we havent yet identified.</li>
        </ol>
        <p>There could be other factors. Further (more expensive) testing with larger datasets might provide answers.
        </p>
      </div>
    </div>


    <div class=" footer">
      <p>&copy;
        <script type="text/javascript">document.write("2022-" + new Date().getFullYear());</script>
        capillaries.io
      </p>
    </div>

  </div>
</body>

</html>